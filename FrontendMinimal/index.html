<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Users â€“ Minimal Frontend</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 780px; margin: 2rem auto; padding: 0 1rem; }
    header { display: flex; align-items: baseline; justify-content: space-between; }
    h1 { font-size: 1.6rem; margin: 0 0 .5rem; }
    .muted { color: #666; font-size: .9rem; }
    input, button { padding: .6rem .8rem; font-size: 1rem; }
    ul { padding: 0; list-style: none; }
    li { display: flex; align-items: center; justify-content: space-between; padding: .5rem .75rem; border: 1px solid #ddd; border-radius: .5rem; margin: .4rem 0; }
    .row { display: flex; gap: .5rem; margin: 1rem 0; }
    .error { color: #b00020; }
    .ok { color: #1b5e20; }
    footer { margin-top: 2rem; font-size: .9rem; color: #666; }
    code { background: #f5f5f5; padding: .1rem .3rem; border-radius: .25rem; }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Users (Minimal Frontend)</h1>
      <div class="muted">Talks to <code>http://localhost:5178/api/users</code></div>
    </div>
  </header>

  <section class="row">
    <input id="name" placeholder="Enter name" />
    <button id="add">Add User</button>
    <span id="msg" class="muted"></span>
  </section>

  <ul id="list"></ul>

  <footer>
    Serve this page via a local static server (for CORS), e.g.:
    <pre>python -m http.server 5500</pre>
    Then open: <code>http://localhost:5500/FrontendMinimal/</code>
  </footer>

  <script>
    const API = "http://localhost:5178/api/users";
    const list = document.getElementById('list');
    const nameInput = document.getElementById('name');
    const addBtn = document.getElementById('add');
    const msg = document.getElementById('msg');

    async function getUsers() {
      list.innerHTML = "<li>Loading...</li>";
      try {
        const r = await fetch(API);
        if (!r.ok) throw new Error("Failed to load users");
        const data = await r.json();
        render(data);
        msg.textContent = "";
      } catch (e) {
        list.innerHTML = "";
        msg.textContent = e.message;
        msg.className = "error";
      }
    }

    function render(users) {
      list.innerHTML = "";
      users.forEach(u => {
        const li = document.createElement('li');
        li.innerHTML = \`
          <span>\${u.id}. \${u.name}</span>
          <button data-id="\${u.id}">Delete</button>
        \`;
        li.querySelector("button").addEventListener("click", () => delUser(u.id));
        list.appendChild(li);
      });
    }

    async function addUser() {
      const name = nameInput.value.trim();
      if (!name) { msg.textContent = "Name is required."; msg.className="error"; return; }
      addBtn.disabled = true;
      try {
        const r = await fetch(API, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name })
        });
        if (!r.ok) throw new Error("Failed to add user");
        nameInput.value = "";
        msg.textContent = "Added!";
        msg.className = "ok";
        await getUsers();
      } catch (e) {
        msg.textContent = e.message;
        msg.className = "error";
      } finally {
        addBtn.disabled = false;
      }
    }

    async function delUser(id) {
      if (!confirm("Delete user " + id + "?")) return;
      try {
        const r = await fetch(API + "/" + id, { method: "DELETE" });
        if (!r.ok && r.status !== 204) throw new Error("Failed to delete");
        await getUsers();
      } catch (e) {
        msg.textContent = e.message;
        msg.className = "error";
      }
    }

    addBtn.addEventListener("click", addUser);
    getUsers();
  </script>
</body>
</html>
